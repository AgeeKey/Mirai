#!/bin/bash

# ๐ MIRAI AGENT - ะะะขะะะะขะะงะะกะะะ ะะะะฃะกะ
# ะญัะพั ัะบัะธะฟั ะฒัะต ัะดะตะปะฐะตั ะทะฐ ัะตะฑั!

set -e  # ะััะฐะฝะพะฒะธัั ะฟัะธ ะพัะธะฑะบะต

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ   ๐ค MIRAI AGENT - ะะซะกะขะะซะ ะกะขะะะข    โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ะะตัะตัะพะด ะฒ ะดะธัะตะบัะพัะธั
cd /root/mirai/mirai-agent

echo "๐ ะะฐะฑะพัะฐั ะดะธัะตะบัะพัะธั: $(pwd)"
echo ""

# ะจะะ 1: ะะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต
echo "๐ฆ ะจะะ 1/5: ะกะพะทะดะฐะฝะธะต ะฒะธัััะฐะปัะฝะพะณะพ ะพะบััะถะตะฝะธั..."
if [ ! -d "venv" ]; then
    python3 -m venv venv
    echo "โ ะะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต ัะพะทะดะฐะฝะพ"
else
    echo "โ ะะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต ัะถะต ัััะตััะฒัะตั"
fi
echo ""

# ะะบัะธะฒะฐัะธั
source venv/bin/activate
echo "โ ะะธัััะฐะปัะฝะพะต ะพะบััะถะตะฝะธะต ะฐะบัะธะฒะธัะพะฒะฐะฝะพ"
echo ""

# ะจะะ 2: ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
echo "๐ฅ ะจะะ 2/5: ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน..."
pip install -q --upgrade pip
pip install -q -r requirements.txt
echo "โ ะัะต ะฑะธะฑะปะธะพัะตะบะธ ัััะฐะฝะพะฒะปะตะฝั"
echo ""

# ะจะะ 3: ะัะพะฒะตัะบะฐ ะบะพะฝัะธะณััะฐัะธะธ
echo "โ๏ธ  ะจะะ 3/5: ะัะพะฒะตัะบะฐ ะบะพะฝัะธะณััะฐัะธะธ..."

# ะัะพะฒะตัะบะฐ API ะบะปััะตะน
if grep -q "sk-proj-" .env && grep -q "xai-" .env; then
    echo "โ API ะบะปััะธ ะฝะฐะนะดะตะฝั ะฒ .env"
else
    echo "โ๏ธ  ะะะะะะะะ: ะัะพะฒะตัั API ะบะปััะธ ะฒ .env ัะฐะนะปะต!"
fi

# ะกะพะทะดะฐะฝะธะต ะดะธัะตะบัะพัะธะน
mkdir -p data/logs
mkdir -p data/backups
mkdir -p state
echo "โ ะะธัะตะบัะพัะธะธ ัะพะทะดะฐะฝั"
echo ""

# ะจะะ 4: ะัะพะฒะตัะบะฐ ะฟะพััะพะฒ
echo "๐ ะจะะ 4/5: ะัะพะฒะตัะบะฐ ะฟะพััะพะฒ..."
if lsof -Pi :8000 -sTCP:LISTEN -t >/dev/null 2>&1; then
    echo "โ๏ธ  ะะพัั 8000 ัะถะต ะทะฐะฝัั!"
    echo "   ะััะฐะฝะพะฒะธัะต ัััะตััะฒัััะธะน ะฟัะพัะตัั ะธะปะธ ะธะทะผะตะฝะธัะต ะฟะพัั"
    echo "   ะขะตะบััะธะน ะฟัะพัะตัั: $(lsof -Pi :8000 -sTCP:LISTEN)"
else
    echo "โ ะะพัั 8000 ัะฒะพะฑะพะดะตะฝ"
fi
echo ""

# ะจะะ 5: ะะฐะฟััะบ
echo "๐ ะจะะ 5/5: ะะะะฃะกะ ะะะะะขะ..."
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ        MIRAI AGENT ะะะะฃะกะะะะขะกะฏ       โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""
echo "๐ ะะพะฝะธัะพัะธะฝะณ:"
echo "   - ะะพะณะธ ะฐะณะตะฝัะฐ: tail -f data/logs/ai_agent.log"
echo "   - ะะพะณะธ ััะตะนะดะตัะฐ: tail -f logs/mirai_agent.log"
echo "   - API ะทะดะพัะพะฒัะต: curl http://localhost:8000/health"
echo ""
echo "โธ๏ธ  ะััะฐะฝะพะฒะบะฐ: Ctrl+C"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ะะฐะฟััะบ
python -m core.master_agent
