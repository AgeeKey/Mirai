<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êú™Êù• Mirai - AI Trading Agent</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Montserrat:wght@600;700;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #13131f;
            --bg-card: rgba(19, 19, 31, 0.8);
            --text-primary: #ffffff;
            --text-secondary: #a0a0b8;
            --text-accent: #8a8aff;
            --border-color: rgba(138, 138, 255, 0.15);
            --gradient-primary: linear-gradient(135deg, #6e56cf 0%, #a361ff 50%, #426ff6 100%);
            --gradient-success: linear-gradient(135deg, #1cd44d 0%, #1cd4af 100%);
            --shadow-glow: 0 0 30px rgba(110, 86, 207, 0.3);
            --shadow-card: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
            line-height: 1.6;
        }
        .bg-effects {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none; z-index: 0; overflow: hidden;
        }
        .bg-circle {
            position: absolute; border-radius: 50%;
            background: var(--gradient-primary);
            opacity: 0.06; filter: blur(100px);
            animation: float 25s infinite ease-in-out;
        }
        .bg-circle:nth-child(1) { width: 500px; height: 500px; top: -250px; left: -250px; }
        .bg-circle:nth-child(2) { width: 600px; height: 600px; bottom: -300px; right: -300px; animation-delay: -12s; }
        .bg-circle:nth-child(3) { width: 400px; height: 400px; top: 40%; left: 60%; animation-delay: -6s; }
        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            33% { transform: translate(40px, -40px) scale(1.15); }
            66% { transform: translate(-30px, 30px) scale(0.9); }
        }
        .header {
            position: fixed; top: 0; left: 0; right: 0; height: 70px;
            background: var(--bg-card); backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; z-index: 100; box-shadow: var(--shadow-card);
        }
        .logo-section { display: flex; align-items: center; gap: 15px; }
        .logo-avatar {
            width: 45px; height: 45px; border-radius: 12px;
            background: var(--gradient-primary);
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; box-shadow: var(--shadow-glow);
        }
        .logo-text { display: flex; flex-direction: column; }
        .logo-title {
            font-family: 'Montserrat', sans-serif; font-size: 22px; font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .logo-subtitle { font-size: 11px; color: var(--text-secondary); margin-top: -2px; }
        .nav-menu { display: flex; gap: 5px; }
        .nav-item {
            padding: 10px 18px; color: var(--text-secondary);
            text-decoration: none; font-size: 14px; font-weight: 500;
            border-radius: 10px; transition: all 0.3s;
        }
        .nav-item:hover { background: rgba(138, 138, 255, 0.1); color: var(--text-primary); }
        .nav-item.active { background: rgba(138, 138, 255, 0.15); color: var(--text-accent); }
        .header-actions { display: flex; align-items: center; gap: 12px; }
        .status-indicator {
            display: flex; align-items: center; gap: 8px;
            padding: 8px 15px;
            background: rgba(28, 212, 77, 0.1);
            border: 1px solid rgba(28, 212, 77, 0.3);
            border-radius: 20px; font-size: 13px;
        }
        .status-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: #1cd44d; animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(28, 212, 77, 0.7); }
            50% { transform: scale(1.1); box-shadow: 0 0 0 6px rgba(28, 212, 77, 0); }
        }
        .theme-toggle {
            width: 40px; height: 40px; border-radius: 50%;
            background: rgba(138, 138, 255, 0.1);
            border: 1px solid var(--border-color);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: all 0.3s; font-size: 18px;
        }
        .theme-toggle:hover { background: rgba(138, 138, 255, 0.2); transform: rotate(20deg); }
        .sidebar {
            position: fixed; left: 0; top: 70px;
            width: 300px; height: calc(100vh - 70px);
            background: var(--bg-card); backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-color);
            padding: 25px; overflow-y: auto; z-index: 90;
        }
        .ai-character {
            text-align: center; margin-bottom: 30px;
            padding-bottom: 25px; border-bottom: 1px solid var(--border-color);
        }
        .character-avatar {
            width: 130px; height: 130px; margin: 0 auto 18px;
            border-radius: 50%; background: var(--gradient-primary);
            display: flex; align-items: center; justify-content: center;
            font-size: 60px; box-shadow: var(--shadow-glow);
            border: 3px solid rgba(138, 138, 255, 0.3);
            animation: float 6s infinite ease-in-out;
        }
        .character-name {
            font-family: 'Montserrat', sans-serif;
            font-size: 20px; font-weight: 700; margin-bottom: 5px;
        }
        .character-status {
            font-size: 13px; color: var(--text-accent); margin-bottom: 10px;
        }
        .character-quote {
            font-size: 12px; font-style: italic;
            color: var(--text-secondary); line-height: 1.5;
        }
        .quick-actions { margin-bottom: 25px; }
        .section-title {
            font-size: 11px; font-weight: 600; text-transform: uppercase;
            color: var(--text-secondary); margin-bottom: 12px; letter-spacing: 1px;
        }
        .action-btn {
            width: 100%; padding: 12px 16px; margin-bottom: 8px;
            background: var(--bg-secondary); border: 1px solid var(--border-color);
            border-radius: 10px; color: var(--text-primary);
            font-size: 14px; display: flex; align-items: center; gap: 12px;
            cursor: pointer; transition: all 0.3s; text-align: left;
        }
        .action-btn i { width: 20px; }
        .action-btn:hover {
            background: var(--gradient-primary); border-color: transparent;
            transform: translateX(5px); box-shadow: var(--shadow-glow);
        }
        .sidebar-stats {
            margin-top: 25px; padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        .stat-row {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 12px; font-size: 13px;
        }
        .stat-label { color: var(--text-secondary); }
        .stat-value {
            color: var(--text-accent); font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }
        .main-content {
            margin-left: 300px; margin-top: 70px; padding: 35px;
            position: relative; z-index: 1; min-height: calc(100vh - 70px);
        }
        .welcome { margin-bottom: 35px; }
        .welcome-title {
            font-family: 'Montserrat', sans-serif;
            font-size: 36px; font-weight: 800; margin-bottom: 8px;
            background: var(--gradient-primary);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .welcome-subtitle {
            color: var(--text-secondary); font-size: 16px; margin-bottom: 5px;
        }
        .current-time {
            font-size: 14px; color: var(--text-accent);
            font-family: 'JetBrains Mono', monospace;
        }
        .dashboard-grid {
            display: grid; grid-template-columns: repeat(4, 1fr);
            gap: 20px; margin-bottom: 35px;
        }
        .card {
            background: var(--bg-card); backdrop-filter: blur(20px);
            border: 1px solid var(--border-color); border-radius: 16px;
            padding: 24px; transition: all 0.3s;
            position: relative; overflow: hidden;
        }
        .card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0;
            height: 3px; background: var(--gradient-primary);
            opacity: 0; transition: opacity 0.3s;
        }
        .card:hover {
            transform: translateY(-5px); box-shadow: var(--shadow-card);
            border-color: rgba(138, 138, 255, 0.3);
        }
        .card:hover::before { opacity: 1; }
        .card-header {
            display: flex; justify-content: space-between;
            align-items: flex-start; margin-bottom: 18px;
        }
        .card-title {
            font-size: 13px; font-weight: 600;
            color: var(--text-secondary); text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .card-icon { font-size: 24px; opacity: 0.7; }
        .card-value {
            font-size: 32px; font-weight: 700;
            background: var(--gradient-primary);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            background-clip: text; margin-bottom: 8px;
            font-family: 'Montserrat', sans-serif;
        }
        .card-label { font-size: 12px; color: var(--text-secondary); }
        .card-mini-chart {
            height: 50px; margin-top: 15px;
            background: rgba(138, 138, 255, 0.05);
            border-radius: 8px; overflow: hidden;
        }
        .section {
            background: var(--bg-card); backdrop-filter: blur(20px);
            border: 1px solid var(--border-color); border-radius: 16px;
            padding: 28px; margin-bottom: 35px;
        }
        .section-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 25px;
        }
        .section-title-large {
            font-family: 'Montserrat', sans-serif;
            font-size: 22px; font-weight: 700;
        }
        .add-btn {
            padding: 10px 20px; background: var(--gradient-primary);
            border: none; border-radius: 10px; color: white;
            font-size: 14px; font-weight: 600; cursor: pointer;
            transition: all 0.3s; display: flex; align-items: center; gap: 8px;
        }
        .add-btn:hover { transform: scale(1.05); box-shadow: var(--shadow-glow); }
        .task-item {
            background: var(--bg-secondary); border: 1px solid var(--border-color);
            border-radius: 12px; padding: 18px;
            display: flex; align-items: center; gap: 15px;
            transition: all 0.3s; margin-bottom: 12px;
        }
        .task-item:hover {
            border-color: rgba(138, 138, 255, 0.3); transform: translateX(5px);
        }
        .task-priority {
            padding: 6px 12px; border-radius: 8px;
            font-size: 11px; font-weight: 700;
            text-transform: uppercase; white-space: nowrap;
        }
        .priority-high {
            background: rgba(225, 29, 72, 0.2); color: #fb7185;
            border: 1px solid rgba(225, 29, 72, 0.3);
        }
        .priority-medium {
            background: rgba(249, 115, 22, 0.2); color: #f7957c;
            border: 1px solid rgba(249, 115, 22, 0.3);
        }
        .priority-low {
            background: rgba(28, 212, 77, 0.2); color: #1cd4af;
            border: 1px solid rgba(28, 212, 77, 0.3);
        }
        .task-content { flex: 1; }
        .task-title { font-weight: 600; margin-bottom: 5px; }
        .task-meta { font-size: 12px; color: var(--text-secondary); }
        .task-status {
            padding: 6px 12px; border-radius: 8px; font-size: 12px;
            background: rgba(138, 138, 255, 0.1);
            border: 1px solid rgba(138, 138, 255, 0.2);
        }
        .task-actions { display: flex; gap: 8px; }
        .task-action-btn {
            width: 32px; height: 32px; border-radius: 8px;
            border: 1px solid var(--border-color); background: transparent;
            color: var(--text-secondary); cursor: pointer; transition: all 0.3s;
            display: flex; align-items: center; justify-content: center;
        }
        .task-action-btn:hover {
            background: rgba(138, 138, 255, 0.2);
            border-color: rgba(138, 138, 255, 0.3);
            color: var(--text-primary);
        }
        .loading {
            display: flex; align-items: center; justify-content: center;
            padding: 40px; color: var(--text-secondary);
        }
        .spinner {
            width: 40px; height: 40px;
            border: 3px solid rgba(138, 138, 255, 0.1);
            border-top-color: var(--text-accent);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .empty-state {
            text-align: center; padding: 60px 20px;
            color: var(--text-secondary);
        }
        .empty-state i {
            font-size: 64px; margin-bottom: 20px; opacity: 0.3;
        }
        .empty-state h3 {
            font-size: 18px; margin-bottom: 8px;
            color: var(--text-primary);
        }
        .empty-state p { font-size: 14px; }
        @media (max-width: 1400px) {
            .dashboard-grid { grid-template-columns: repeat(3, 1fr); }
        }
        @media (max-width: 1024px) {
            .dashboard-grid { grid-template-columns: repeat(2, 1fr); }
            .sidebar { transform: translateX(-100%); transition: transform 0.3s; }
            .main-content { margin-left: 0; }
        }
        @media (max-width: 768px) {
            .dashboard-grid { grid-template-columns: 1fr; }
            .nav-menu { display: none; }
        }
        ::-webkit-scrollbar { width: 10px; }
        ::-webkit-scrollbar-track { background: rgba(138, 138, 255, 0.05); }
        ::-webkit-scrollbar-thumb {
            background: rgba(138, 138, 255, 0.2); border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover { background: rgba(138, 138, 255, 0.3); }
    </style>
</head>
<body>
    <div class="bg-effects">
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
        <div class="bg-circle"></div>
    </div>

    <header class="header">
        <div class="logo-section">
            <div class="logo-avatar">ü§ñ</div>
            <div class="logo-text">
                <div class="logo-title">Êú™Êù• MIRAI</div>
                <div class="logo-subtitle">AI Trading Agent</div>
            </div>
        </div>
        <nav class="nav-menu">
            <a href="#dashboard" class="nav-item active">
                <i class="fas fa-chart-line"></i> –î–∞—à–±–æ—Ä–¥
            </a>
            <a href="#tasks" class="nav-item">
                <i class="fas fa-tasks"></i> –ó–∞–¥–∞—á–∏
            </a>
            <a href="#trading" class="nav-item">
                <i class="fas fa-chart-bar"></i> –¢—Ä–µ–π–¥–∏–Ω–≥
            </a>
            <a href="#memory" class="nav-item">
                <i class="fas fa-brain"></i> –ü–∞–º—è—Ç—å
            </a>
        </nav>
        <div class="header-actions">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="agent-status">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            </div>
            <div class="theme-toggle">
                <i class="fas fa-moon"></i>
            </div>
        </div>
    </header>

    <aside class="sidebar">
        <div class="ai-character">
            <div class="character-avatar">üå∏</div>
            <div class="character-name">–Æ –ú–∏–Ω (Ë™âÊòé)</div>
            <div class="character-status" id="uptime-status">–ê–∫—Ç–∏–≤–Ω–∞: –∑–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="character-quote">"–°–≤–µ—Ç –≤–µ–¥—ë—Ç –≤–ø–µ—Ä—ë–¥, –∏ —è –æ—Å–≤–µ—â–∞—é —Ç–≤–æ–π –ø—É—Ç—å"</div>
        </div>
        <div class="quick-actions">
            <div class="section-title">–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
            <button class="action-btn" onclick="createTask()">
                <i class="fas fa-plus-circle"></i> –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞
            </button>
            <button class="action-btn" onclick="refreshData()">
                <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            </button>
            <button class="action-btn" onclick="openChat()">
                <i class="fas fa-comments"></i> –ß–∞—Ç —Å –ú–∏—Ä–∞–π
            </button>
            <button class="action-btn" onclick="viewMemory()">
                <i class="fas fa-database"></i> –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞–º—è—Ç–∏
            </button>
            <button class="action-btn" onclick="analyzeTrade()">
                <i class="fas fa-robot"></i> –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞
            </button>
        </div>
        <div class="sidebar-stats">
            <div class="section-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
            <div class="stat-row">
                <span class="stat-label">üß† –¢–æ–∫–µ–Ω–æ–≤</span>
                <span class="stat-value" id="tokens-used">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">‚úÖ –ó–∞–¥–∞—á</span>
                <span class="stat-value" id="tasks-completed">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">üìö –°–µ—Å—Å–∏–π</span>
                <span class="stat-value" id="learning-sessions">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">üíº –ü–æ–∑–∏—Ü–∏–π</span>
                <span class="stat-value" id="open-positions">-</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">üí∞ –ë–∞–ª–∞–Ω—Å</span>
                <span class="stat-value" id="balance">-</span>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <div class="welcome">
            <h1 class="welcome-title">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ö–æ–º–∞–Ω–¥–∏—Ä</h1>
            <p class="welcome-subtitle">–ú–∏—Ä–∞–π –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ. –ß–µ–º –∑–∞–π–º–µ–º—Å—è —Å–µ–≥–æ–¥–Ω—è?</p>
            <div class="current-time" id="current-time"></div>
        </div>

        <div class="dashboard-grid">
            <div class="card">
                <div class="card-header">
                    <div class="card-title">–ê–≥–µ–Ω—Ç Mirai</div>
                    <div class="card-icon">ü§ñ</div>
                </div>
                <div class="card-value" id="agent-uptime">-</div>
                <div class="card-label">–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã</div>
                <div class="card-mini-chart"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">AI –î–≤–∏–∂–æ–∫</div>
                    <div class="card-icon">üß†</div>
                </div>
                <div class="card-value">GPT-4</div>
                <div class="card-label" id="ai-usage">–ü–æ–¥–∫–ª—é—á–µ–Ω</div>
                <div class="card-mini-chart"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">–ó–∞–¥–∞—á–∏</div>
                    <div class="card-icon">üìã</div>
                </div>
                <div class="card-value" id="tasks-total">-</div>
                <div class="card-label" id="tasks-pending-label">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="card-mini-chart"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">–¢—Ä–µ–π–¥–∏–Ω–≥</div>
                    <div class="card-icon">üìà</div>
                </div>
                <div class="card-value" id="trading-balance">-</div>
                <div class="card-label" id="trading-positions">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                <div class="card-mini-chart"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">API –°–µ—Ä–≤–µ—Ä</div>
                    <div class="card-icon">üîå</div>
                </div>
                <div class="card-value">Online</div>
                <div class="card-label">–î–æ—Å—Ç—É–ø–µ–Ω</div>
                <div class="card-mini-chart"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">Telegram Bot</div>
                    <div class="card-icon">üí¨</div>
                </div>
                <div class="card-value">Active</div>
                <div class="card-label">–ü–æ–¥–∫–ª—é—á–µ–Ω</div>
                <div class="card-mini-chart"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">–ü–∞–º—è—Ç—å</div>
                    <div class="card-icon">üíæ</div>
                </div>
                <div class="card-value" id="memory-count">-</div>
                <div class="card-label">–ó–∞–ø–∏—Å–µ–π –≤ –±–∞–∑–µ</div>
                <div class="card-mini-chart"></div>
            </div>
            <div class="card">
                <div class="card-header">
                    <div class="card-title">–û–±—É—á–µ–Ω–∏–µ</div>
                    <div class="card-icon">üìö</div>
                </div>
                <div class="card-value" id="learning-count">-</div>
                <div class="card-label">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π</div>
                <div class="card-mini-chart"></div>
            </div>
        </div>

        <div class="section">
            <div class="section-header">
                <h2 class="section-title-large">
                    <i class="fas fa-tasks"></i> –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏
                </h2>
                <button class="add-btn" onclick="createTask()">
                    <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É
                </button>
            </div>
            <div id="tasks-container">
                <div class="loading"><div class="spinner"></div></div>
            </div>
        </div>
    </main>

    <script>
        let agentStartTime = Date.now();
        let statsData = {};

        document.addEventListener('DOMContentLoaded', () => {
            updateTime();
            setInterval(updateTime, 1000);
            loadDashboardData();
            setInterval(loadDashboardData, 5000);
        });

        function updateTime() {
            const now = new Date();
            const options = { 
                hour: '2-digit', minute: '2-digit', second: '2-digit',
                weekday: 'long', day: 'numeric', month: 'long', year: 'numeric'
            };
            document.getElementById('current-time').textContent = now.toLocaleString('ru-RU', options);
            updateUptime();
        }

        function updateUptime() {
            const diff = Date.now() - agentStartTime;
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const uptimeStr = `${days}–¥ ${hours}—á ${minutes}–º`;
            const el = document.getElementById('agent-uptime');
            if (el) el.textContent = uptimeStr;
            const statusEl = document.getElementById('uptime-status');
            if (statusEl) statusEl.textContent = `–ê–∫—Ç–∏–≤–Ω–∞: ${uptimeStr}`;
        }

        async function loadDashboardData() {
            try {
                const healthRes = await fetch('/health');
                const health = await healthRes.json();
                document.getElementById('agent-status').textContent = 
                    health.agent_running ? '–ê–≥–µ–Ω—Ç –∞–∫—Ç–∏–≤–µ–Ω' : '–ê–≥–µ–Ω—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
                
                const statsRes = await fetch('/stats');
                const stats = await statsRes.json();
                statsData = stats;
                updateDashboardCards(stats);
                
                const tasksRes = await fetch('/agent/tasks');
                const tasks = await tasksRes.json();
                updateTasksSection(tasks);
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('agent-status').textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è';
            }
        }

        function updateDashboardCards(stats) {
            const tasksCompleted = stats.agent?.tasks_completed || 0;
            const tasksTotal = stats.agent?.tasks_total || 0;
            const tasksPending = stats.agent?.tasks_pending || 0;
            
            document.getElementById('tasks-completed').textContent = tasksCompleted;
            document.getElementById('tasks-total').textContent = tasksTotal;
            document.getElementById('tasks-pending-label').textContent = `${tasksPending} –≤ –æ—á–µ—Ä–µ–¥–∏`;
            
            const learningSessions = stats.agent?.learning_sessions || 0;
            document.getElementById('learning-sessions').textContent = learningSessions;
            document.getElementById('learning-count').textContent = learningSessions;
            
            const balance = stats.trading?.balance || 0;
            const positions = stats.trading?.positions || 0;
            
            document.getElementById('balance').textContent = `$${balance.toFixed(2)}`;
            document.getElementById('trading-balance').textContent = `$${balance.toFixed(2)}`;
            document.getElementById('trading-positions').textContent = `${positions} –ø–æ–∑–∏—Ü–∏–π`;
            document.getElementById('open-positions').textContent = positions;
            
            const tokensEstimate = Math.floor(tasksCompleted * 150 + learningSessions * 800);
            document.getElementById('tokens-used').textContent = 
                tokensEstimate > 1000 ? `${(tokensEstimate/1000).toFixed(1)}K` : tokensEstimate;
            document.getElementById('ai-usage').textContent = 
                `~${(tokensEstimate/1000).toFixed(1)}K —Ç–æ–∫–µ–Ω–æ–≤`;
            
            document.getElementById('memory-count').textContent = tasksCompleted + learningSessions;
        }

        function updateTasksSection(tasks) {
            const container = document.getElementById('tasks-container');
            if (!tasks || tasks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á</h3>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</p>
                    </div>`;
                return;
            }
            
            const priorityMap = { 3: 'high', 2: 'medium', 1: 'low' };
            const priorityText = { 3: '–í—ã—Å–æ–∫–∏–π', 2: '–°—Ä–µ–¥–Ω–∏–π', 1: '–ù–∏–∑–∫–∏–π' };
            
            container.innerHTML = tasks.map(task => {
                const priority = priorityMap[task.priority] || 'medium';
                const priorityLabel = priorityText[task.priority] || '–°—Ä–µ–¥–Ω–∏–π';
                return `
                    <div class="task-item">
                        <div class="task-priority priority-${priority}">${priorityLabel}</div>
                        <div class="task-content">
                            <div class="task-title">${task.description || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'}</div>
                            <div class="task-meta">
                                ID: ${task.id.substring(0, 8)} ‚Ä¢ 
                                –°–æ–∑–¥–∞–Ω–æ: ${new Date(task.created_at || Date.now()).toLocaleString('ru-RU')}
                            </div>
                        </div>
                        <div class="task-status">${task.status || 'pending'}</div>
                        <div class="task-actions">
                            <button class="task-action-btn" title="–ü—Ä–æ—Å–º–æ—Ç—Ä">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="task-action-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="task-action-btn" onclick="deleteTask('${task.id}')" title="–£–¥–∞–ª–∏—Ç—å">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>`;
            }).join('');
        }

        function refreshData() {
            loadDashboardData();
            alert('‚úÖ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
        }

        async function createTask() {
            const title = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏:');
            if (!title) return;
            const priority = prompt('–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç (high/medium/low):', 'medium');
            try {
                const res = await fetch('/agent/tasks', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ title: title, priority: priority || 'medium' })
                });
                const data = await res.json();
                if (data.status === 'created') {
                    alert('‚úÖ –ó–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞');
                    loadDashboardData();
                } else {
                    alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–¥–∞—á–∏');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è');
            }
        }

        function deleteTask(taskId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–¥–∞—á—É?')) return;
            alert('‚ö†Ô∏è –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∏—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        }

        function openChat() { alert('‚ÑπÔ∏è –ß–∞—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function viewMemory() { alert('‚ÑπÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–∞–º—è—Ç–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ'); }
        function analyzeTrade() { alert('‚ÑπÔ∏è –ê–Ω–∞–ª–∏–∑ —Ä—ã–Ω–∫–∞ –∑–∞–ø—É—â–µ–Ω'); }

        document.querySelector('.theme-toggle').addEventListener('click', function() {
            alert('‚ÑπÔ∏è –°–º–µ–Ω–∞ —Ç–µ–º—ã –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
        });
    </script>
</body>
</html>
