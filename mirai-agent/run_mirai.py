#!/usr/bin/env python3
"""
MIRAI - –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫ –¢–û–õ–¨–ö–û —Å OpenAI
–ë–µ–∑ Telegram, –±–µ–∑ Binance, –±–µ–∑ –ª–∏—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
"""

import os
import asyncio
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º .env
load_dotenv()

from core.autonomous_agent import AutonomousAgent


async def main():
    """–ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—É—Å–∫ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞"""
    
    print("=" * 70)
    print("ü§ñ MIRAI - –ê–í–¢–û–ù–û–ú–ù–´–ô AI –ê–ì–ï–ù–¢")
    print("=" * 70)
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ OpenAI –∫–ª—é—á–∞
    api_key = os.getenv("OPENAI_API_KEY")
    if not api_key:
        print("‚ùå –û—à–∏–±–∫–∞: OPENAI_API_KEY –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ .env")
        print("üí° –î–æ–±–∞–≤—å—Ç–µ –∫–ª—é—á –≤ —Ñ–∞–π–ª /root/mirai/mirai-agent/.env")
        return
    
    print(f"‚úÖ OpenAI API Key: {api_key[:20]}...")
    print("-" * 70)
    
    # –°–æ–∑–¥–∞–µ–º –∞–≥–µ–Ω—Ç–∞
    agent = AutonomousAgent()
    print(f"‚úÖ –ê–≥–µ–Ω—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
    print(f"üìä –ú–æ–¥–µ–ª—å: {agent.model}")
    print(f"üõ†Ô∏è  –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤: {len(agent.tools)}")
    print("-" * 70)
    
    # –î–∞–µ–º –∞–≥–µ–Ω—Ç—É –Ω–∞—á–∞–ª—å–Ω—É—é –∑–∞–¥–∞—á—É
    print("\nüéØ –ó–∞–ø—É—Å–∫–∞—é –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π —Ä–µ–∂–∏–º...")
    print("–ê–≥–µ–Ω—Ç –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ")
    print("–ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏\n")
    print("=" * 70)
    
    try:
        # –¶–∏–∫–ª –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã
        iteration = 1
        while True:
            print(f"\nüîÑ –ò—Ç–µ—Ä–∞—Ü–∏—è #{iteration}")
            print("-" * 70)
            
            # –ê–≥–µ–Ω—Ç —Å–∞–º —Ä–µ—à–∞–µ—Ç —á—Ç–æ –¥–µ–ª–∞—Ç—å
            result = agent.think(
                """–¢—ã –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π AI –∞–≥–µ–Ω—Ç MIRAI. 
                
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∏ —É–ª—É—á—à–∞—Ç—å –ø—Ä–æ–µ–∫—Ç.

–ß—Ç–æ —Ç—ã –º–æ–∂–µ—à—å —Å–¥–µ–ª–∞—Ç—å –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å:
1. –ò–∑—É—á–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ (read_file)
2. –ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª–µ–∑–Ω—ã–π –∫–æ–¥ (write_file)
3. –ù–∞–π—Ç–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ (search_web)
4. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∫–æ–¥ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ (execute_python)
5. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –¥–ª—è —Å–µ–±—è (create_task)

–í—ã–±–µ—Ä–∏ –æ–¥–Ω–æ –¥–µ–π—Å—Ç–≤–∏–µ –∏ –≤—ã–ø–æ–ª–Ω–∏ –µ–≥–æ. –ë—É–¥—å –ø–æ–ª–µ–∑–Ω—ã–º –∏ –ø—Ä–æ–∞–∫—Ç–∏–≤–Ω—ã–º!"""
            )
            
            print(f"\nüìù –†–µ–∑—É–ª—å—Ç–∞—Ç:\n{result}\n")
            print("=" * 70)
            
            iteration += 1
            
            # –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∏—Ç–µ—Ä–∞—Ü–∏—è–º–∏
            await asyncio.sleep(30)  # 30 —Å–µ–∫—É–Ω–¥ –º–µ–∂–¥—É —Ü–∏–∫–ª–∞–º–∏
            
    except KeyboardInterrupt:
        print("\n\nüõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–≥–µ–Ω—Ç–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
        print("=" * 70)


if __name__ == "__main__":
    asyncio.run(main())
