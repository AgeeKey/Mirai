#!/usr/bin/env bash
set -euo pipefail

SERVICE=mirai-agent
API="http://127.0.0.1:8000"
DB="/root/mirai/mirai-agent/data/state/mirai.db"
LOGUNIT="mirai-agent"

divider() { printf "\n%s\n" "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê"; }
section() { printf "\nüîç %s\n" "$1"; printf "%s\n" "‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"; }

echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë     ü§ñ MIRAI FULL DIAGNOSTICS - $(date -u +"%Y-%m-%d %H:%M:%S UTC")     ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
section "1Ô∏è‚É£  24/7 –ê–í–¢–û–ù–û–ú–ù–û–°–¢–¨"
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

echo "üì¶ Systemd —Å—Ç–∞—Ç—É—Å:"
systemctl is-enabled "$SERVICE" 2>/dev/null && echo "  ‚úÖ Enabled (–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫)" || echo "  ‚ùå Disabled"
systemctl is-active  "$SERVICE" 2>/dev/null && echo "  ‚úÖ Active (—Ä–∞–±–æ—Ç–∞–µ—Ç)" || echo "  ‚ùå Inactive"

echo ""
echo "üîÑ Restart –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:"
systemctl show "$SERVICE" -p Restart -p RestartSec 2>/dev/null || echo "  ‚ùå Service not found"

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
section "2Ô∏è‚É£  AI –†–ï–ê–õ–¨–ù–û –†–ê–ë–û–¢–ê–ï–¢ (OpenAI/Grok)"
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

echo "üß† LLM –∑–∞–ø—Ä–æ—Å—ã –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É:"
LLM_COUNT=$(journalctl -u "$LOGUNIT" --since "1 min ago" 2>/dev/null | \
  grep -E "api\.openai\.com|api\.x\.ai|/api/generate" | wc -l || echo 0)

if [ "$LLM_COUNT" -gt 0 ]; then
  echo "  ‚úÖ $LLM_COUNT –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ AI (—Ä–∞–±–æ—Ç–∞–µ—Ç!)"
  journalctl -u "$LOGUNIT" --since "1 min ago" 2>/dev/null | \
    grep -E "api\.openai\.com|api\.x\.ai" | tail -3
else
  echo "  ‚ö†Ô∏è  0 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É"
  echo "  –ü—Ä–æ–≤–µ—Ä—è—é –∑–∞ 5 –º–∏–Ω—É—Ç..."
  LLM_COUNT_5=$(journalctl -u "$LOGUNIT" --since "5 min ago" 2>/dev/null | \
    grep -E "api\.openai\.com|api\.x\.ai" | wc -l || echo 0)
  echo "  üìä –ó–∞ 5 –º–∏–Ω—É—Ç: $LLM_COUNT_5 –∑–∞–ø—Ä–æ—Å–æ–≤"
fi

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
section "3Ô∏è‚É£  API –°–ï–†–í–ï–†"
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

echo "üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤:"

check_endpoint() {
  local endpoint="$1"
  if curl -sf "$API$endpoint" > /dev/null 2>&1; then
    echo "  ‚úÖ $endpoint"
  else
    echo "  ‚ùå $endpoint"
  fi
}

check_endpoint "/health"
check_endpoint "/status"
check_endpoint "/tasks"

echo ""
echo "üìä –î–∞–Ω–Ω—ã–µ /health:"
curl -s "$API/health" 2>/dev/null | python3 -m json.tool 2>/dev/null || echo "  ‚ùå –ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω"

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
section "4Ô∏è‚É£  –ê–í–¢–û–ù–û–ú–ù–´–ï –ó–ê–î–ê–ß–ò"
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

echo "üìù –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç:"

CREATED=$(journalctl -u "$LOGUNIT" --since "5 min ago" 2>/dev/null | grep -c "Task created" || echo 0)
COMPLETED=$(journalctl -u "$LOGUNIT" --since "5 min ago" 2>/dev/null | grep -c "Task completed" || echo 0)

echo "  –°–æ–∑–¥–∞–Ω–æ:    $CREATED"
echo "  –í—ã–ø–æ–ª–Ω–µ–Ω–æ:  $COMPLETED"

if [ "$CREATED" -gt 0 ] && [ "$COMPLETED" -gt 0 ]; then
  echo "  ‚úÖ –ê–≥–µ–Ω—Ç –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∑–∞–¥–∞—á–∞–º–∏!"
else
  echo "  ‚ö†Ô∏è  –ù–∏–∑–∫–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á"
fi

echo ""
echo "üéØ –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:"
journalctl -u "$LOGUNIT" --since "10 min ago" 2>/dev/null | \
  grep "Task created" | tail -3 | sed 's/^/  /'

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
section "5Ô∏è‚É£  TELEGRAM –ë–û–¢"
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

echo "üì± Telegram –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–Ω—É—Ç—É:"

TG_GET=$(journalctl -u "$LOGUNIT" --since "1 min ago" 2>/dev/null | grep -c "api.telegram.org.*getUpdates" || echo 0)
TG_SEND=$(journalctl -u "$LOGUNIT" --since "5 min ago" 2>/dev/null | grep -c "sendMessage" || echo 0)

echo "  getUpdates:  $TG_GET –∑–∞–ø—Ä–æ—Å–æ–≤ (polling)"
echo "  sendMessage: $TG_SEND —Å–æ–æ–±—â–µ–Ω–∏–π (–æ—Ç–≤–µ—Ç—ã)"

if [ "$TG_GET" -gt 0 ]; then
  echo "  ‚úÖ –ë–æ—Ç –∞–∫—Ç–∏–≤–Ω–æ —Å–ª—É—à–∞–µ—Ç Telegram"
else
  echo "  ‚ùå –ë–æ—Ç –Ω–µ –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Telegram"
fi

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
section "6Ô∏è‚É£  –ë–ê–ó–ê –î–ê–ù–ù–´–•"
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

if [ -f "$DB" ]; then
  echo "üíæ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–π–¥–µ–Ω–∞: $DB"
  echo "  –†–∞–∑–º–µ—Ä: $(du -h "$DB" | cut -f1)"
  
  echo ""
  echo "üìä –¢–∞–±–ª–∏—Ü—ã –≤ –ë–î:"
  sqlite3 "$DB" "SELECT name FROM sqlite_master WHERE type='table';" 2>/dev/null | sed 's/^/  /'
  
  echo ""
  echo "üß† –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 –∑–∞–ø–∏—Å–∏ –ø–∞–º—è—Ç–∏:"
  sqlite3 "$DB" "SELECT id, type, substr(content,1,50) as content, timestamp FROM memories ORDER BY id DESC LIMIT 3;" 2>/dev/null | sed 's/^/  /' || echo "  (—Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)"
  
  echo ""
  echo "üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Ç–æ—Ä–≥–æ–≤—ã—Ö —Ä–µ—à–µ–Ω–∏—è:"
  sqlite3 "$DB" "SELECT id, symbol, action, substr(reasoning,1,40) as reasoning FROM trading_decisions ORDER BY id DESC LIMIT 3;" 2>/dev/null | sed 's/^/  /' || echo "  (—Ç–∞–±–ª–∏—Ü–∞ –ø—É—Å—Ç–∞ –∏–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)"
else
  echo "‚ùå –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ù–ï –Ω–∞–π–¥–µ–Ω–∞: $DB"
fi

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
section "7Ô∏è‚É£  –õ–û–ì–ò"
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

echo "üìù –†–∞–∑–º–µ—Ä –ª–æ–≥–æ–≤:"
if [ -d "/root/mirai/mirai-agent/data/logs" ]; then
  du -sh /root/mirai/mirai-agent/data/logs 2>/dev/null || echo "  ‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞"
  echo ""
  echo "üìÅ –§–∞–π–ª—ã –ª–æ–≥–æ–≤:"
  ls -lh /root/mirai/mirai-agent/data/logs/*.log 2>/dev/null | awk '{print "  " $9 " - " $5}' || echo "  (–Ω–µ—Ç —Ñ–∞–π–ª–æ–≤)"
else
  echo "  ‚ùå –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ª–æ–≥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
fi

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
section "8Ô∏è‚É£  –û–®–ò–ë–ö–ò"
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

echo "‚ùå –û—à–∏–±–∫–∏ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç:"
ERROR_COUNT=$(journalctl -u "$LOGUNIT" --since "5 min ago" 2>/dev/null | grep -i "error" | grep -v "error.log" | wc -l || echo 0)

echo "  –í—Å–µ–≥–æ –æ—à–∏–±–æ–∫: $ERROR_COUNT"

if [ "$ERROR_COUNT" -gt 0 ]; then
  echo ""
  echo "  –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –æ—à–∏–±–æ–∫:"
  journalctl -u "$LOGUNIT" --since "5 min ago" 2>/dev/null | \
    grep -i "error" | grep -v "error.log" | tail -5 | sed 's/^/  /'
else
  echo "  ‚úÖ –û—à–∏–±–æ–∫ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ"
fi

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
section "9Ô∏è‚É£  –†–ï–°–£–†–°–´"
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

echo "üíª –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤:"

PID=$(pgrep -f 'python3.*main.py' 2>/dev/null || true)
if [ -n "$PID" ]; then
  echo "  ‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –Ω–∞–π–¥–µ–Ω (PID: $PID)"
  echo ""
  ps -p "$PID" -o pid,etime,rss,pmem,pcpu,cmd 2>/dev/null | sed 's/^/  /'
else
  echo "  ‚ùå –ü—Ä–æ—Ü–µ—Å—Å Mirai –Ω–µ –Ω–∞–π–¥–µ–Ω"
fi

# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
section "üîü –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê"
# ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

SCORE=0
MAX_SCORE=10

# –ü–æ–¥—Å—á—ë—Ç –±–∞–ª–ª–æ–≤
systemctl is-active "$SERVICE" >/dev/null 2>&1 && ((SCORE++)) || true
systemctl is-enabled "$SERVICE" >/dev/null 2>&1 && ((SCORE++)) || true
[ "$LLM_COUNT" -gt 0 ] || [ "$LLM_COUNT_5" -gt 0 ] && ((SCORE++)) || true
curl -sf "$API/health" >/dev/null 2>&1 && ((SCORE++)) || true
[ "$CREATED" -gt 0 ] && ((SCORE++)) || true
[ "$COMPLETED" -gt 0 ] && ((SCORE++)) || true
[ "$TG_GET" -gt 0 ] && ((SCORE++)) || true
[ -f "$DB" ] && ((SCORE++)) || true
[ "$ERROR_COUNT" -eq 0 ] && ((SCORE++)) || true
[ -n "$PID" ] && ((SCORE++)) || true

echo ""
echo "üìä –û—Ü–µ–Ω–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏: $SCORE/$MAX_SCORE"
echo ""

if [ "$SCORE" -ge 9 ]; then
  echo "üü¢ ‚úÖ –û–¢–õ–ò–ß–ù–û! Mirai —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–Ω–æ–º–Ω–æ!"
elif [ "$SCORE" -ge 7 ]; then
  echo "üü° ‚ö†Ô∏è  –•–û–†–û–®–û. –ï—Å—Ç—å –Ω–µ–±–æ–ª—å—à–∏–µ –ø—Ä–æ–±–ª–µ–º—ã."
elif [ "$SCORE" -ge 5 ]; then
  echo "üü† ‚ö†Ô∏è  –£–î–û–í–õ–ï–¢–í–û–†–ò–¢–ï–õ–¨–ù–û. –¢—Ä–µ–±—É–µ—Ç—Å—è –≤–Ω–∏–º–∞–Ω–∏–µ."
else
  echo "üî¥ ‚ùå –ö–†–ò–¢–ò–ß–ù–û! –ú–Ω–æ–≥–æ –ø—Ä–æ–±–ª–µ–º, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ."
fi

divider
echo ""
echo "üí° –î–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã–ø–æ–ª–Ω–∏:"
echo "   sudo journalctl -u mirai-agent -f          # Real-time –ª–æ–≥–∏"
echo "   curl http://localhost:8000/health          # –ü—Ä–æ–≤–µ—Ä–∫–∞ API"
echo "   curl http://localhost:8000/status          # –°—Ç–∞—Ç—É—Å –∞–≥–µ–Ω—Ç–∞"
echo ""
echo "üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: /root/mirai/MIRAI_READY_REPORT.md"
echo ""
